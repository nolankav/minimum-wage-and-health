# Reorder outcomes
coef_df$Outcome <- factor(
coef_df$Outcome, levels=c("Sad or hopeless", "Considered suicide", "Attempted suicide", "Recent alcohol", "Recent marijuana", "Physical fight"))
# Reorder categories
coef_df$Category <- factor(
coef_df$Category, levels=c("Symptoms", "Substances", "School"))
# Reorder samples
coef_df$Sample <- factor(
coef_df$Sample, levels=c(
# Standard models
"Adolescents (FE only)",
"Adolescents (fully adjusted)",
# Sub-population models
"Black or Hispanic/Latino",
# Robustness checks
"Adolescents (2020 dollars)",
"Adolescents (lagged wage)",
# State-level cluster models
"Adolescents (FE only, nested clust.)",
"Adolescents (FE only, state clust.)",
"Adolescents (fully adj., nested clust.)",
"Adolescents (fully adj., state clust.)"
))
# Return df
return(coef_df)
}
# Function to generate coefficient plots.
# Requires: Df of coefficients, y title, y limits, color order.
# Returns: Formatted coefficient plot.
print_coef_plot <- function(coef_df, Y_TITLE, Y_MIN, Y_MAX, COLORS) {
# Set grayscale colors
if (COLORS == "Standard") {
COLOR_MAX <- 0
COLOR_MIN <- 0.7
}
if (COLORS == "Reversed") {
COLOR_MAX <- 0.7
COLOR_MIN <- 0
}
# Generate coefficient plot
plot <- ggplot(coef_df, aes(x=Outcome, y=effect, group=Sample, color=Sample)) +
# Null line
geom_hline(yintercept=0, color="black", linewidth=0.25) +
# Point estimates with distinct shapes
geom_point(position = position_dodge(width=0.6), size=1, aes(shape=Sample)) +
scale_shape_manual(values = 1:nlevels(coef_df$Sample)) +
# Confidence intervals
geom_errorbar(aes(ymin=effect-1.96*se, ymax=effect+1.96*se),
position = position_dodge(width=0.6), width=0, linewidth=0.8) +
geom_errorbar(aes(ymin=effect-2.94*se, ymax=effect+2.94*se),
position = position_dodge(width=0.6), width=0.3, alpha=0.5) +
# Titles
ylab(Y_TITLE) +
ggtitle("Adolescents (12-18), 2001-2019") +
# Theme modifications
theme_test() +
theme(legend.position = "bottom",
text = element_text(size = 10, face = "bold"),
axis.text.x = element_text(angle=45, hjust=1, vjust=1),
axis.title.x = element_blank(),
axis.ticks = element_blank(),
strip.background = element_blank(),
legend.title = element_blank(),
panel.grid.major.x = element_blank(),
panel.grid.major.y = element_line(color="light gray", linewidth=0.5),
panel.grid.minor.y = element_line(color="light gray", linewidth=0.25)) +
scale_y_continuous(limits = c(Y_MIN, Y_MAX),
breaks = seq(-0.1, 0.1, 0.02),
minor_breaks = seq(-0.1, 0.1, 0.01),
labels = function(x) paste0(x*100," pp")) +
scale_color_grey(start=COLOR_MIN, end=COLOR_MAX) +
facet_grid(~Category, scales="free", space="free_x")
# Return plot
return(plot)
}
# Subset to treated or control state-years
yrbs_all_cs <- subset(yrbs_all_model, fipsst %in% c(CONTROL_2, TREATED_2) &
year %in% c(2011:2019))
# Define treated period
yrbs_all_cs <- yrbs_all_cs %>% mutate(
period_cs = case_when(
fipsst %in% c(12,29) ~ 2013,
fipsst %in% c(10,30,34,36,5,15,24,31,46,54) ~ 2015,
fipsst %in% CONTROL_2 ~ 0
))
# Treat cluster as numeric
yrbs_all_cs$cluster_num <- as.numeric(as.factor(yrbs_all_cs$cluster))
# Set seed
set.seed(1234)
yrbs_all_cs_1 <- yrbs_all_cs %>%
filter_at(vars(sad_hopeless, Year, period_cs), all_vars(!is.na(.)))
atts_1 <- att_gt(yname = "sad_hopeless",
tname = "Year",
gname = "period_cs",
control_group = "nevertreated",
clustervars   = "cluster_num",
panel = FALSE,
xformla = ~age_2 + sex_2 + race_eth_2 + grade_2 +
elig_1_5 + elig_6_18 + has_eitc + federal_pct + refundable,
data = yrbs_all_cs_1,
weightsname = "weight_2",
allow_unbalanced_panel = TRUE,
base_period = "universal",
pl = TRUE,
cores = 4,
print_details = TRUE)
atts_1 <- att_gt(yname = "sad_hopeless",
tname = "Year",
gname = "period_cs",
control_group = "nevertreated",
clustervars   = "cluster_num",
panel = FALSE,
xformla = ~age_2 + sex_2 + race_eth_2 + grade_2 +
elig_1_5 + has_eitc + federal_pct + refundable,
data = yrbs_all_cs_1,
weightsname = "weight_2",
allow_unbalanced_panel = TRUE,
base_period = "universal",
pl = TRUE,
cores = 4,
print_details = TRUE)
atts_1 <- att_gt(yname = "sad_hopeless",
tname = "Year",
gname = "period_cs",
control_group = "nevertreated",
clustervars   = "cluster_num",
panel = FALSE,
xformla = ~age_2 + sex_2 + race_eth_2 + grade_2 +
elig_1_5 + has_eitc + federal_pct,
data = yrbs_all_cs_1,
weightsname = "weight_2",
allow_unbalanced_panel = TRUE,
base_period = "universal",
pl = TRUE,
cores = 4,
print_details = TRUE)
atts_1 <- att_gt(yname = "sad_hopeless",
tname = "Year",
gname = "period_cs",
control_group = "nevertreated",
clustervars   = "cluster_num",
panel = FALSE,
xformla = ~age_2 + sex_2 + race_eth_2 + grade_2 +
elig_1_5 + has_eitc,
data = yrbs_all_cs_1,
weightsname = "weight_2",
allow_unbalanced_panel = TRUE,
base_period = "universal",
pl = TRUE,
cores = 4,
print_details = TRUE)
atts_1 <- att_gt(yname = "sad_hopeless",
tname = "Year",
gname = "period_cs",
control_group = "nevertreated",
clustervars   = "cluster_num",
panel = FALSE,
xformla = ~age_2 + sex_2 + race_eth_2 + grade_2 +
elig_1_5,
data = yrbs_all_cs_1,
weightsname = "weight_2",
allow_unbalanced_panel = TRUE,
base_period = "universal",
pl = TRUE,
cores = 4,
print_details = TRUE)
atts_1 <- att_gt(yname = "sad_hopeless",
tname = "Year",
gname = "period_cs",
control_group = "nevertreated",
clustervars   = "cluster_num",
panel = FALSE,
xformla = ~age_2 + sex_2 + race_eth_2 + grade_2 +
elig_1_5 + federal_pct,
data = yrbs_all_cs_1,
weightsname = "weight_2",
allow_unbalanced_panel = TRUE,
base_period = "universal",
pl = TRUE,
cores = 4,
print_details = TRUE)
atts_1 <- att_gt(yname = "sad_hopeless",
tname = "Year",
gname = "period_cs",
control_group = "nevertreated",
clustervars   = "cluster_num",
panel = FALSE,
xformla = ~age_2 + sex_2 + race_eth_2 + grade_2 +
elig_1_5 + has_eitc,
data = yrbs_all_cs_1,
weightsname = "weight_2",
allow_unbalanced_panel = TRUE,
base_period = "universal",
pl = TRUE,
cores = 4,
print_details = TRUE)
atts_1 <- att_gt(yname = "sad_hopeless",
tname = "Year",
gname = "period_cs",
control_group = "nevertreated",
clustervars   = "cluster_num",
panel = FALSE,
xformla = ~age_2 + sex_2 + race_eth_2 + grade_2 +
elig_1_5 + elig_6_18,
data = yrbs_all_cs_1,
weightsname = "weight_2",
allow_unbalanced_panel = TRUE,
base_period = "universal",
pl = TRUE,
cores = 4,
print_details = TRUE)
?att_gtx
?att_gt
atts_1 <- att_gt(yname = "sad_hopeless",
tname = "Year",
gname = "period_cs",
control_group = "nevertreated",
clustervars   = "cluster_num",
panel = FALSE,
xformla = ~age_2 + sex_2 + race_eth_2 + grade_2 +
elig_6_18,
data = yrbs_all_cs_1,
weightsname = "weight_2",
allow_unbalanced_panel = TRUE,
base_period = "universal",
pl = TRUE,
cores = 4,
print_details = TRUE)
cor.test(yrbs_all_model$elig_1_5, yrbs_all_model$elig_6_18)
atts_1 <- att_gt(yname = "sad_hopeless",
tname = "Year",
gname = "period_cs",
control_group = "nevertreated",
clustervars   = "cluster_num",
panel = FALSE,
xformla = ~age_2 + sex_2 + race_eth_2 + grade_2 +
elig_6_18,
data = yrbs_all_cs_1,
weightsname = "weight_2",
allow_unbalanced_panel = TRUE,
base_period = "universal",
pl = TRUE,
cores = 4,
print_details = TRUE)
# Plot event-study coefficients
event_plot_1 <- ggdid(agg_event_1) +
geom_vline(xintercept=-1, color="black", linetype="dashed") +
geom_hline(yintercept=0, color="black") +
geom_errorbar(width=0.2) +
geom_point() +
geom_line() +
theme_test() +
theme(plot.title         = element_blank(),
legend.position    = "none",
text               = element_text(size = 10, face = "bold"),
axis.ticks         = element_blank(),
panel.grid.major.y = element_line(color = "gray", size = 0.25)) +
xlab("Year relative to raise") +
ylab("Adj. coefficients for\nsad and hopeless") +
scale_y_continuous(labels = function(x) paste0(x*100," pp")) +
scale_x_continuous(breaks=seq(-4,6,2)) +
coord_cartesian(ylim=c(-0.1,0.1)) +
annotate("text", x=-0.5, y=0.075, label="Raised above\nfederal min. wage",
fontface=2, size=3, hjust=0, vjust=0.5)
# Model: Sad and hopeless
# Note: Subset to complete cases
yrbs_all_cs_1 <- yrbs_all_cs %>%
filter_at(vars(sad_hopeless, Year, period_cs), all_vars(!is.na(.)))
atts_1 <- att_gt(yname = "sad_hopeless",
tname = "Year",
gname = "period_cs",
control_group = "nevertreated",
clustervars   = "cluster_num",
panel = FALSE,
xformla = ~age_2 + sex_2 + race_eth_2 + grade_2,
data = yrbs_all_cs_6,
weightsname = "weight_2",
allow_unbalanced_panel = TRUE,
base_period = "universal",
pl = TRUE,
cores = 4,
print_details = TRUE)
# Set seed
set.seed(1234)
# Model: Sad and hopeless
# Note: Subset to complete cases
yrbs_all_cs_1 <- yrbs_all_cs %>%
filter_at(vars(sad_hopeless, Year, period_cs), all_vars(!is.na(.)))
atts_1 <- att_gt(yname = "sad_hopeless",
tname = "Year",
gname = "period_cs",
control_group = "nevertreated",
clustervars   = "cluster_num",
panel = FALSE,
xformla = ~age_2 + sex_2 + race_eth_2 + grade_2,
data = yrbs_all_cs_1,
weightsname = "weight_2",
allow_unbalanced_panel = TRUE,
base_period = "universal",
pl = TRUE,
cores = 4,
print_details = TRUE)
# Model: Considered suicide
# Note: Subset to complete cases
yrbs_all_cs_2 <- yrbs_all_cs %>%
filter_at(vars(cons_suicide, Year, period_cs), all_vars(!is.na(.)))
atts_2 <- att_gt(yname = "cons_suicide",
tname = "Year",
gname = "period_cs",
control_group = "nevertreated",
clustervars   = "cluster_num",
panel = FALSE,
xformla = ~age_2 + sex_2 + race_eth_2 + grade_2,
data = yrbs_all_cs_2,
weightsname = "weight_2",
allow_unbalanced_panel = TRUE,
base_period = "universal",
pl = TRUE,
cores = 4,
print_details = TRUE)
# Model: Attempted suicide
# Note: Subset to complete cases
yrbs_all_cs_3 <- yrbs_all_cs %>%
filter_at(vars(suicide_att, Year, period_cs), all_vars(!is.na(.)))
atts_3 <- att_gt(yname = "suicide_att",
tname = "Year",
gname = "period_cs",
control_group = "nevertreated",
clustervars   = "cluster_num",
panel = FALSE,
xformla = ~age_2 + sex_2 + race_eth_2 + grade_2,
data = yrbs_all_cs_3,
weightsname = "weight_2",
allow_unbalanced_panel = TRUE,
base_period = "universal",
pl = TRUE,
cores = 4,
print_details = TRUE)
# Model: Physical fight
# Note: Subset to complete cases
yrbs_all_cs_4 <- yrbs_all_cs %>%
filter_at(vars(fight, Year, period_cs), all_vars(!is.na(.)))
atts_4 <- att_gt(yname = "fight",
tname = "Year",
gname = "period_cs",
control_group = "nevertreated",
clustervars   = "cluster_num",
panel = FALSE,
xformla = ~age_2 + sex_2 + race_eth_2 + grade_2,
data = yrbs_all_cs_4,
weightsname = "weight_2",
allow_unbalanced_panel = TRUE,
base_period = "universal",
pl = TRUE,
cores = 4,
print_details = TRUE)
# Model: Recent alcohol use
# Note: Subset to complete cases
yrbs_all_cs_5 <- yrbs_all_cs %>%
filter_at(vars(alcohol, Year, period_cs), all_vars(!is.na(.)))
atts_5 <- att_gt(yname = "alcohol",
tname = "Year",
gname = "period_cs",
control_group = "nevertreated",
clustervars   = "cluster_num",
panel = FALSE,
xformla = ~age_2 + sex_2 + race_eth_2 + grade_2,
data = yrbs_all_cs_5,
weightsname = "weight_2",
allow_unbalanced_panel = TRUE,
base_period = "universal",
pl = TRUE,
cores = 4,
print_details = TRUE)
# Model: Recent marijuana use
# Note: Subset to complete cases
yrbs_all_cs_6 <- yrbs_all_cs %>%
filter_at(vars(marijuana, Year, period_cs), all_vars(!is.na(.)))
atts_6 <- att_gt(yname = "marijuana",
tname = "Year",
gname = "period_cs",
control_group = "nevertreated",
clustervars   = "cluster_num",
panel = FALSE,
xformla = ~age_2 + sex_2 + race_eth_2 + grade_2,
data = yrbs_all_cs_6,
weightsname = "weight_2",
allow_unbalanced_panel = TRUE,
base_period = "universal",
pl = TRUE,
cores = 4,
print_details = TRUE)
# Generate aggregate event studies
agg_event_1 <- aggte(atts_1, type = "dynamic")
agg_event_2 <- aggte(atts_2, type = "dynamic")
agg_event_3 <- aggte(atts_3, type = "dynamic")
agg_event_4 <- aggte(atts_4, type = "dynamic")
agg_event_5 <- aggte(atts_5, type = "dynamic")
agg_event_6 <- aggte(atts_6, type = "dynamic")
summary(agg_event_1); summary(agg_event_2); summary(agg_event_3)
summary(agg_event_4); summary(agg_event_5); summary(agg_event_6)
# Plot event-study coefficients
event_plot_1 <- ggdid(agg_event_1) +
geom_vline(xintercept=-1, color="black", linetype="dashed") +
geom_hline(yintercept=0, color="black") +
geom_errorbar(width=0.2) +
geom_point() +
geom_line() +
theme_test() +
theme(plot.title         = element_blank(),
legend.position    = "none",
text               = element_text(size = 10, face = "bold"),
axis.ticks         = element_blank(),
panel.grid.major.y = element_line(color = "gray", size = 0.25)) +
xlab("Year relative to raise") +
ylab("Adj. coefficients for\nsad and hopeless") +
scale_y_continuous(labels = function(x) paste0(x*100," pp")) +
scale_x_continuous(breaks=seq(-4,6,2)) +
coord_cartesian(ylim=c(-0.1,0.1)) +
annotate("text", x=-0.5, y=0.075, label="Raised above\nfederal min. wage",
fontface=2, size=3, hjust=0, vjust=0.5)
event_plot_2 <- ggdid(agg_event_2) +
geom_vline(xintercept=-1, color="black", linetype="dashed") +
geom_hline(yintercept=0, color="black") +
geom_errorbar(width=0.2) +
geom_point() +
geom_line() +
theme_test() +
theme(plot.title         = element_blank(),
legend.position    = "none",
text               = element_text(size = 10, face = "bold"),
axis.ticks         = element_blank(),
panel.grid.major.y = element_line(color = "gray", size = 0.25)) +
xlab("Year relative to raise") +
ylab("Adj. coefficients for\nconsidered suicide") +
scale_y_continuous(labels = function(x) paste0(x*100," pp")) +
scale_x_continuous(breaks=seq(-4,6,2)) +
coord_cartesian(ylim=c(-0.1,0.1))
event_plot_3 <- ggdid(agg_event_3) +
geom_vline(xintercept=-1, color="black", linetype="dashed") +
geom_hline(yintercept=0, color="black") +
geom_errorbar(width=0.2) +
geom_point() +
geom_line() +
theme_test() +
theme(plot.title         = element_blank(),
legend.position    = "none",
text               = element_text(size = 10, face = "bold"),
axis.ticks         = element_blank(),
panel.grid.major.y = element_line(color = "gray", size = 0.25)) +
xlab("Year relative to raise") +
ylab("Adj. coefficients for\nattempting suicide") +
scale_y_continuous(labels = function(x) paste0(x*100," pp")) +
scale_x_continuous(breaks=seq(-4,6,2)) +
coord_cartesian(ylim=c(-0.1,0.1))
event_plot_4 <- ggdid(agg_event_4) +
geom_vline(xintercept=-1, color="black", linetype="dashed") +
geom_hline(yintercept=0, color="black") +
geom_errorbar(width=0.2) +
geom_point() +
geom_line() +
theme_test() +
theme(plot.title         = element_blank(),
legend.position    = "none",
text               = element_text(size = 10, face = "bold"),
axis.ticks         = element_blank(),
panel.grid.major.y = element_line(color = "gray", size = 0.25)) +
xlab("Year relative to raise") +
ylab("Adj. coefficients for\nphysical fight") +
scale_y_continuous(labels = function(x) paste0(x*100," pp")) +
scale_x_continuous(breaks=seq(-4,6,2)) +
coord_cartesian(ylim=c(-0.1,0.1))
event_plot_5 <- ggdid(agg_event_5) +
geom_vline(xintercept=-1, color="black", linetype="dashed") +
geom_hline(yintercept=0, color="black") +
geom_errorbar(width=0.2) +
geom_point() +
geom_line() +
theme_test() +
theme(plot.title         = element_blank(),
legend.position    = "none",
text               = element_text(size = 10, face = "bold"),
axis.ticks         = element_blank(),
panel.grid.major.y = element_line(color = "gray", size = 0.25)) +
xlab("Year relative to raise") +
ylab("Adj. coefficients for\nrecent alcohol use") +
scale_y_continuous(labels = function(x) paste0(x*100," pp")) +
scale_x_continuous(breaks=seq(-4,6,2)) +
coord_cartesian(ylim=c(-0.1,0.1))
event_plot_6 <- ggdid(agg_event_6) +
geom_vline(xintercept=-1, color="black", linetype="dashed") +
geom_hline(yintercept=0, color="black") +
geom_errorbar(width=0.2) +
geom_point() +
geom_line() +
theme_test() +
theme(plot.title         = element_blank(),
legend.position    = "none",
text               = element_text(size = 10, face = "bold"),
axis.ticks         = element_blank(),
panel.grid.major.y = element_line(color = "gray", size = 0.25)) +
xlab("Year relative to raise") +
ylab("Adj. coefficients for\nrecent marijuana use") +
scale_y_continuous(labels = function(x) paste0(x*100," pp")) +
scale_x_continuous(breaks=seq(-4,6,2)) +
coord_cartesian(ylim=c(-0.1,0.1))
# Compile figures
event_all <- plot_grid(event_plot_1, event_plot_2, event_plot_3,
event_plot_4, event_plot_5, event_plot_6, nrow=3)
# Export figure
ggsave(plot=event_all, file="Exhibits/YRBS event studies, nested errors.pdf",
width=6, height=6, units='in', dpi=600)
